
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>User Dashboard</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" type = "text/css" href="{{ url_for('static', filename = 'css/user_dashboardCSS.css') }}" title = "home page CSS"/>
	<script  src="https://code.jquery.com/jquery-3.3.1.min.js"   integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="   crossorigin="anonymous"></script>
  <script type="text/javascript">
    var myToken = localStorage.getItem("myToken")
    var myUsername = localStorage.getItem("myUsername")

    if ((myToken == null) || (myToken == "")) {
      document.location.href = "/"
    }
		function logout(){
		localStorage.removeItem("myToken")
			localStorage.removeItem("myUsername")
			document.location.href = "/"
		}
    var page = 1
  </script>
  <script>
	  function navShrink() {
	    var x = document.getElementById("myTopnav");
	    if (x.className === "topnav") {
	      x.className += " responsive";
	    } else {
	      x.className = "topnav";
	    }
	  }
		function scrollToTop() {
		  document.body.scrollTop = 0; // For Safari
		  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
		}

  </script>
</head>
<body>
<button onclick="scrollToTop()" id="myBtn" title="Go to top">TOP</button>
<div class="header">
	<div class = "topheader">
		<img src = "/static/perm_images/logo.jpg" alt = "Logo, Avatar, Character"/>
	</div>
	<div class="topnav" id="myTopnav">
		<div class="topnav-right">
			<a href="#logout"onclick="logout()">Log out</a>
			<a href="javascript:void(0);" class="icon" onclick="navShrink()">
			<i class="menu-bars"></i>
			</a>
		</div>
	</div>
</div>

<div class="rowShape">
	<div class="col-d-11 col-t-12"><!--TITLE OF PAGE-->
		<h2>User Dashboard</h2>
	</div>
	<!-- <a href='#' class="notification">
		<span>Notifications</span>
		<span class="badge"</span>
	</a> -->
	<div class="col-d-2 col-t-12"><!--DISPLAY USER PROJECTS-->
		<form id="projectForm">
			<input id = "button_submit" type="submit" value="My Projects"/>
			<div id="show_user_projects"></div>
		</form>
		<script type="application/javascript">

			$("#projectForm").submit(function (e){

				var action = "/user_dashboard/projects?page=" + page
				$.ajax({
					type: "GET",
					url: action,
					processData: false,
					dataType: 'json',
					async: false,
					headers: {
						"Authorization": "Bearer " + myToken
					},
					data: $("#projectForm").serialize(),

					success: function (response) {

						// EXTRACT VALUE FOR HTML HEADER.
						// ('Book ID', 'Book Name', 'Category' and 'Price')
						var col = [];
						for (var i = 0; i < response.length; i++) {
								for (var key in response[i]) {

										if (col.indexOf(key) === -1) {
												col.push(key);
										}
								}
						}

						// CREATE DYNAMIC TABLE.
						var table = document.createElement("table");

						// CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

						var tr = table.insertRow(-1);                   // TABLE ROW.

						for (var i = 0; i < col.length; i++) {
								var th = document.createElement("th");      // TABLE HEADER.
								th.innerHTML = col[i];
								tr.appendChild(th);
						}

						for (var i = 0; i < response.length; i++) {
							tr = table.insertRow(-1);

							for (var j = 0; j < col.length; j++) {
								var tabCell = tr.insertCell(-1);
								tabCell.innerHTML = response[i][col[j]];
							}
						}

						//alert(table)
						var divContainer = document.getElementById("show_user_projects");
						//alert(divContainer)
						divContainer.innerHTML = "";
						divContainer.appendChild(table);
						//$("#showData").html("")
						//$("#showData").append(table)
				},
					error: function (error) {
						alert(JSON.stringify(error))
					},
					complete: function () {
						// Handle the complete event
					}
				});
				e.preventDefault() ;
			}) ;
		</script>
	</div>
	<div class="col-d-2 col-t-12"><!--SPACE-->
	</div>
  <div class="col-d-3 col-t-12"><!--DISPLAY VULNERABILITES OF A PROJECT-->
    <form id="opForm">
			<input type="text"  class="form-control" id = user_vuln_project placeholder="Enter Project Name" name="user_vuln_project" required>
  		<input type="submit" value="Project Vulnerabilities"/>
  		<div id="show_project_vulnerabilities"></div>
    </form>
    <script type="application/javascript">

      $("#opForm").submit(function (e){

        var action = "/user_dashboard/vulnerabilities?page=" + page
        $.ajax({
          type: "GET",
          url: action,
          processData: false,
          dataType: 'json',
          async: false,
          headers: {
            "Authorization": "Bearer " + myToken
          },
          data: $("#opForm").serialize(),

          success: function (response) {

            // EXTRACT VALUE FOR HTML HEADER.
            // ('Book ID', 'Book Name', 'Category' and 'Price')
            var col = [];
            for (var i = 0; i < response.length; i++) {
                for (var key in response[i]) {

                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }

            // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");

            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

            var tr = table.insertRow(-1);                   // TABLE ROW.

            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

						for (var i = 0; i < response.length; i++) {
            	tr = table.insertRow(-1);

							for (var j = 0; j < col.length; j++) {
				      	var tabCell = tr.insertCell(-1);
				        tabCell.innerHTML = response[i][col[j]];
				      }
				    }

						//alert(table)
            var divContainer = document.getElementById("show_project_vulnerabilities");
						//alert(divContainer)
            divContainer.innerHTML = "";
            divContainer.appendChild(table);
            //$("#showData").html("")
						//$("#showData").append(table)
        },
          error: function (error) {
            alert(JSON.stringify(error))
          },
          complete: function () {
            // Handle the complete event
          }
        });
        e.preventDefault() ;
      }) ;
    </script>

  </div>
	<div class="col-d-3 col-t-12"><!--CREATE NEW PROJECT-->
		<div class="project_container">
			<form id = "create_projectFORM">
				<div class="form-group">
					<input type="text" class="form-control" id = "project_name" placeholder="Enter New Project Name" name="project_name" value= "{{project_name}}" required>
					<input type="submit" value="Create a Project">
					<input type="reset" value="Reset">
				</div>
			</form>
			<script type="application/javascript">

	      $("#create_projectFORM").submit(function (e){

	        var action = "/user_dashboard/new_project"
	        $.ajax({
	          type: "POST",
	          url: action,
	          processData: false,
	          dataType: 'json',
	          async: false,
	          headers: {
	            "Authorization": "Bearer " + myToken
	          },
	          data: $("#create_projectFORM").serialize(),
	          success: function (response) {
	        },
	          error: function (error) {
	          },
	          complete: function () {
	            // Handle the complete event
	          }
	        });
	        e.preventDefault() ;
	      }) ;
	    </script>
		</div>
	</div>
	<div class="col-d-11 col-t-12"><!--LINE-->
	</div>
	<div class="col-d-3 col-t-12"><!-- ADD COMPONENT-->
		<div class="register_container">
			<form id = "add_componentFORM">
				<div class="form-group">
					<input type="text" class="form-control" id = "project_name" placeholder="Enter Project Name" name="project_name" value= "{{project_name}}" required>
					<input type="text"  class="form-control" id = "component_name" placeholder="Enter Component Name" name="component_name"value="{{component_name}}" required>
					<input type="text"  class="form-control" id = "component_type" placeholder="Enter Component Type" name="component_type"value="{{component_type}}" required>
					<input type="text"  class="form-control" id = "version" placeholder="Enter Version of Component" name="version" value= "{{version}}" required> <!--MIGHT NEED TO HAVE DIFF VARIABLE NAMES-->
					<input type="submit" value="Add component to Project">
				</div>
			</form>
			<script type="application/javascript">

				$("#add_componentFORM").submit(function (e){

					var action = "/manage/new_component"
					$.ajax({
						type: "POST",
						url: action,
						processData: false,
						dataType: 'json',
						async: false,
						headers: {
							"Authorization": "Bearer " + myToken
						},
						data: $("#add_componentFORM").serialize(),
						success: function (response) {
					},
						error: function (error) {
						},
						complete: function () {
							// Handle the complete event
						}
					});
					e.preventDefault() ;
				}) ;
			</script>
		</div>
	</div>

	<div class="col-d-2 col-t-12"> <!--LOGOUT-->
	</div>
	<div class="col-d-3 col-t-12"><!--DELETE COMPONENT-->
		<div class="project_container">
			<form id = "delete_componentFORM">
				<div class="form-group">
					<input type="text" class="form-control" id = "del_project_name" placeholder="Name of Project" name="project_name" value= "{{project_name}}" required>
					<input type="text" class="form-control" id = "del_component_name" placeholder="Name of Component" name="component_name" value= "{{component_name}}" required>
					<input type="submit" value="Delete a Component">
				</div>
			</form>
			<script type="application/javascript">

				$("#delete_componentFORM").submit(function (e){

					var action = "/user_dashboard/delete_component"
					$.ajax({
						type: "POST",
						url: action,
						processData: false,
						dataType: 'json',
						async: false,
						headers: {
							"Authorization": "Bearer " + myToken
						},
						data: $("#delete_componentFORM").serialize(),
						success: function (response) {
					},
						error: function (error) {
						},
						complete: function () {
							// Handle the complete event
						}
					});
					e.preventDefault() ;
				}) ;
			</script>
		</div>
	</div>
	<div class="col-d-3 col-t-12"><!--DELETE PROJECT-->
		<div class="project_container">
			<form id = "delete_projectFORM">
				<div class="form-group">
					<input type="text" class="form-control" id = "del_project_name" placeholder="Enter Project Name" name="del_project_name" value= "{{del_project_name}}" required>
					<input type="submit" value="Delete a Project">
					<input type="reset" value="Reset">
				</div>
			</form>
			<script type="application/javascript">

				$("#delete_projectFORM").submit(function (e){

					var action = "/user_dashboard/delete_project"
					$.ajax({
						type: "POST",
						url: action,
						processData: false,
						dataType: 'json',
						async: false,
						headers: {
							"Authorization": "Bearer " + myToken
						},
						data: $("#delete_projectFORM").serialize(),
						success: function (response) {
					},
						error: function (error) {
						},
						complete: function () {
							// Handle the complete event
						}
					});
					e.preventDefault() ;
				}) ;
			</script>
		</div>
	</div>
</div>
</body>
