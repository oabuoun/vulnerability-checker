
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>User | Vulnerabilities</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" type = "text/css" href="{{ url_for('static', filename = 'css/user_dashboardCSS.css') }}" title = "home page CSS"/>
	<script  src="https://code.jquery.com/jquery-3.3.1.min.js"   integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="   crossorigin="anonymous"></script>
  <script type="text/javascript">// FUNCTIONS
    var myToken = localStorage.getItem("myToken")
    var myUsername = localStorage.getItem("myUsername")

    if ((myToken == null) || (myToken == "")) {
      document.location.href = "/"
    }
		function logout(){
		localStorage.removeItem("myToken")
			localStorage.removeItem("myUsername")
			document.location.href = "/"
		}
		function dashboard(){
		 document.location.href = "/user_dashboard?myToken="+ myToken
		}
		function project(){
		 document.location.href = "/user_dashboard/project?myToken="+ myToken
		}
		function vulnerability(){
		 document.location.href = "/user_dashboard/vulnerability?myToken="+ myToken
		}
		function component(){
		 document.location.href = "/user_dashboard/component?myToken="+ myToken
		}
		function account_details(){
		 document.location.href = "/user_dashboard/account_details?myToken="+ myToken
		}
    var page = 1
  </script>
  <script>
	  function navShrink() {
	    var x = document.getElementById("myTopnav");
	    if (x.className === "topnav") {
	      x.className += " responsive";
	    } else {
	      x.className = "topnav";
	    }
	  }
		function scrollToTop() {
		  document.body.scrollTop = 0; // For Safari
		  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
		}

  </script>
</head>
<body>
<button onclick="scrollToTop()" id="myBtn" title="Go to top">TOP</button>
<div class="header">
	<div class = "topheader">
		<img src = "/static/perm_images/logo.jpg" alt = "Logo, Avatar, Character"/>
	</div>
	<div class="topnav" id="myTopnav">
		<a href="#dashboard"onclick="dashboard()">Dashboard</a>
		<a href="#account"onclick="account_details()">Account Details</a>
		<div class="topnav-right">
			<a href="#logout"onclick="logout()">Log out</a>
			<a href="javascript:void(0);" class="icon" onclick="navShrink()">
			<i class="menu-bars"></i>
			</a>
		</div>
	</div>
</div>

<div class="rowShape">
	<div class="col-d-11 col-t-12"><!--TITLE OF PAGE-->
		<h2>Vulnerabilities</h2>
	</div>
	<div class = "col-d-2 col-t-12"><!--VERTICAL MENU-->
		<div class="vertical-menu">
		  <a href="#project"onclick="project()">Projects</a>
		  <a href="#vuln"onclick="vulnerability()">Vulnerabilities</a>
		  <a href="#comp"onclick="component()">Components</a>
		</div>
	</div>
  <div class="col-d-6 col-t-12"><!--DISPLAY VULNERABILITES OF A PROJECT-->
    <form id="vuln_showForm">
			<input type="text"  class="form-control" id = "project_vulns" placeholder="Enter Project Name" name="project_vulns" required>
  		<input type="submit" value="Project Vulnerabilities">
  		<div id="show_project_vulnerabilities"></div>
    </form>
    <script type="application/javascript">

      $("#vuln_showForm").submit(function (e){

        var action = "/user_dashboard/vulnerability/vulnerabilities?page=" + page//"/user_dashboard/vulnerabilities?page=" + page
        $.ajax({
          type: "GET",
          url: action,
          processData: false,
          dataType: 'json',
          async: false,
          headers: {
            "Authorization": "Bearer " + myToken
          },
          data: $("#vuln_showForm").serialize(),

          success: function (response) {

            // EXTRACT VALUE FOR HTML HEADER.
            // ('Book ID', 'Book Name', 'Category' and 'Price')
            var col = [];
            for (var i = 0; i < response.length; i++) {
                for (var key in response[i]) {

                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }

            // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");

            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

            var tr = table.insertRow(-1);                   // TABLE ROW.

            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

						for (var i = 0; i < response.length; i++) {
            	tr = table.insertRow(-1);

							for (var j = 0; j < col.length; j++) {
				      	var tabCell = tr.insertCell(-1);
				        tabCell.innerHTML = response[i][col[j]];
				      }
				    }

						//alert(table)
            var divContainer = document.getElementById("show_project_vulnerabilities");
						//alert(divContainer)
            divContainer.innerHTML = "";
            divContainer.appendChild(table);
            //$("#showData").html("")
						//$("#showData").append(table)
        },
          error: function (error) {
            alert(JSON.stringify(error))
          },
          complete: function () {
            // Handle the complete event
          }
        });
        e.preventDefault() ;
      }) ;
    </script>

  </div>
	<div class="col-d-3 col-t-12"><!--DEACTIVATE VULN-->
		<div class="project_container">
			<form id = "deactivate_vulnFORM">
				<div class="form-group">
					<input type="text" class="form-control" id = "deactivate_vuln" placeholder="Enter CVE ID" name="deactivate_vuln" value= "{{cve_id}}" required>
					<input type="submit" value="Deactivate a vulnerability">
					<input type="reset" value="Reset">
				</div>
			</form>
			<script type="application/javascript">

				$("#deactivate_vulnFORM").submit(function (e){

					var action = "/user_dashboard/vulnerability/deactivate_vuln"
					$.ajax({
						type: "POST",
						url: action,
						processData: false,
						dataType: 'json',
						async: false,
						headers: {
							"Authorization": "Bearer " + myToken
						},
						data: $("#deactivate_vulnFORM").serialize(),
						success: function (response) {
					},
						error: function (error) {
						},
						complete: function () {
							// Handle the complete event
						}
					});
					e.preventDefault() ;
				}) ;
			</script>
		</div>
	</div>
</div>
</body>
